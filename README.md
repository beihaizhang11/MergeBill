# Excel账单合并工具

一个功能强大且易于使用的桌面应用程序，用于从多个相同模板的Excel账单中提取特定数据并汇总到一个Excel表格中。

## 主要特点

✨ **简洁直观的界面** - 按钮操作，支持多选文件和文件夹批量导入

🔧 **高度可配置** - 灵活的映射配置系统，轻松定义要提取的数据项

📋 **多预设支持** - 创建多个预设配置，快速处理不同类型的账单

🎯 **精确定位** - 通过单元格引用（如A1, B2）精确指定数据位置

🤖 **智能提取** - 自动搜索指定列的关键词并提取结算金额，可自定义配置

📁 **批量处理** - 支持文件夹批量导入，自动识别所有Excel文件

👀 **实时预览** - 预览Excel文件内容，方便配置映射关系

## 功能介绍

### 1. 主界面
- **文件列表区域**：显示已添加的Excel文件
- **预设选择**：从下拉列表中选择要使用的配置预设
- **添加文件按钮**：
  - **添加文件**：手动选择一个或多个Excel文件
  - **添加文件夹**：自动扫描文件夹中的所有Excel文件
- **文件管理**：
  - **移除选中**：删除列表中选中的文件
  - **清空列表**：清空所有已添加的文件
- **拖拽支持**：如果系统支持，可以直接拖拽文件到窗口（可选功能）

### 2. 预设管理
- **新建预设**：创建新的账单配置
- **复制预设**：基于现有预设创建副本
- **重命名**：修改预设名称
- **删除预设**：删除不需要的配置

### 3. 映射配置
- **项目名称**：定义要提取的数据项名称（如"日期"、"金额"、"客户名称"）
- **单元格位置**：指定该数据在Excel模板中的位置（如A1, B5, C10）
- **说明**：添加备注信息，方便理解和维护
- **调整顺序**：通过上移/下移调整输出列的顺序

### 4. 自动提取功能（可配置）
- **结算金额自动提取**：程序会在指定列中搜索指定关键词的单元格
- 找到后，自动提取该单元格右侧的数值
- 该数值会自动添加到汇总表的"结算金额"列（最后一列）
- **可自定义配置**：
  - **搜索列**：指定在哪一列搜索（如 D、E、F 等）
  - **搜索关键词**：指定要搜索的文本（如"折后总计"、"合计金额"等）
  - 每个预设可以有不同的配置，适应不同的账单模板

### 5. Excel预览
- 查看Excel文件的内容
- 点击单元格查看其位置信息
- 方便快速配置映射关系

## 安装说明

### 环境要求
- Python 3.7 或更高版本
- Windows / macOS / Linux

### 安装步骤

1. **克隆或下载本项目**
```bash
cd C:\Develop\ExcelTools\MergeBill
```

2. **安装依赖包**
```bash
pip install openpyxl
```

注意：如果需要拖拽功能（可选），可以额外安装：
```bash
pip install tkinterdnd2
```
但这不是必需的，程序没有这个包也能正常运行。

3. **运行程序**
```bash
python main.py
```

## 使用指南

### 快速开始

1. **配置预设**
   - 点击"管理预设"按钮
   - 创建新预设或编辑默认预设
   - 添加映射项目：设置项目名称和对应的单元格位置
   - 配置结算金额提取规则：
     * 设置搜索列（如 D）
     * 设置搜索关键词（如"折后总计"）
   - 点击"保存配置"按钮

2. **导入文件**
   - 选择要使用的预设
   - 点击"添加文件"按钮选择Excel文件（支持多选）
   - 或点击"添加文件夹"按钮，程序会自动找到文件夹中所有Excel文件
   - 查看文件列表，可以移除不需要的文件

3. **开始合并**
   - 点击"开始合并"按钮
   - 选择输出文件保存位置
   - 等待处理完成

### 配置示例

假设您有以下格式的账单Excel文件：

```
A         B        C         D            E
日期      客户     金额      项目         金额
2024-01-01  张三   1000     商品小计     1000
                           折扣         -100
                           折后总计     900
```

您可以创建如下映射配置：

| 项目名称 | 单元格位置 | 说明 |
|---------|-----------|------|
| 日期    | A1        | 账单日期 |
| 客户名称 | B1        | 客户姓名 |
| 金额    | C1        | 原始金额 |

**注意**：
- 默认配置：程序在D列搜索"折后总计"，并提取E列的值（本例中为900）
- 可在预设配置中自定义搜索列和关键词
- 例如：可以设置在C列搜索"总计"，或在E列搜索"应付金额"

### 单元格引用说明

- 列使用字母表示：A, B, C, ..., Z, AA, AB, ...
- 行使用数字表示：1, 2, 3, ...
- 单元格引用格式：列字母 + 行号
  - 示例：A1（第一列第一行）、B5（第二列第五行）、AA10（第27列第10行）

## 打包成EXE

如果您想将程序打包成独立的exe文件（无需安装Python），请按以下步骤操作：

### 方法1：使用一键打包脚本（最简单）

1. **安装打包工具**
```bash
pip install pyinstaller
```

2. **运行打包脚本**
```bash
# Windows下双击运行
build.bat

# 或在命令行中运行
build.bat
```

3. **获取exe文件**
   - 打包完成后，在 `dist` 文件夹中找到 `Excel账单合并工具.exe`
   - 这是一个独立的可执行文件，可以在任何Windows电脑上运行

### 方法2：打包调试版本

如果需要查看程序运行日志，使用调试版本：
```bash
build_with_console.bat
```
生成的exe会显示控制台窗口，方便排查问题。

### 方法3：使用高级打包脚本

```bash
python build_advanced.py
```
提供更多选项：
- 单文件 / 多文件模式
- 显示 / 隐藏控制台
- 批量打包多个版本

详细说明请查看 `打包说明.txt` 文件。

### 打包后的使用

1. 将 `Excel账单合并工具.exe` 复制到任意位置
2. 双击运行，首次运行会自动生成配置文件
3. 无需安装Python或其他依赖

## 项目结构

```
MergeBill/
│
├── main.py                      # 主程序入口
├── config_manager.py            # 配置管理模块
├── excel_processor.py           # Excel处理模块
├── config_editor.py             # 配置编辑界面
├── requirements.txt             # 依赖包列表
├── config.json                  # 配置文件（运行后自动生成）
├── README.md                    # 说明文档
│
├── run.bat                      # 快速启动脚本
│
├── build.bat                    # 一键打包脚本（标准版）
├── build_with_console.bat       # 一键打包脚本（调试版）
├── build_advanced.py            # 高级打包脚本
└── 打包说明.txt                 # 详细打包说明
```

## 技术栈

- **GUI框架**：tkinter（Python标准库）
- **Excel处理**：openpyxl
- **配置存储**：JSON
- **开发语言**：Python 3
- **可选组件**：tkinterdnd2（拖拽功能，非必需）

## 常见问题

### Q: 如何知道数据在哪个单元格？
A: 使用"预览Excel"功能，点击单元格即可查看其位置信息。

### Q: 可以处理多少个文件？
A: 理论上没有限制，但建议单次处理不超过1000个文件以确保性能。

### Q: 支持哪些Excel格式？
A: 支持 .xlsx 和 .xls 格式。

### Q: 如果某些文件的单元格为空怎么办？
A: 程序会自动处理空单元格，在结果中显示为空值。

### Q: 配置文件保存在哪里？
A: 配置保存在程序目录下的 config.json 文件中。

### Q: "结算金额"功能是否可以关闭？
A: 该功能自动运行，如果没有找到指定关键词，结算金额列会显示为空，不影响其他数据。

### Q: 如何修改搜索列和关键词？
A: 在"管理预设"界面中，可以直接修改"结算金额搜索列"和"结算金额关键词"两个配置项。每个预设可以有不同的设置。

### Q: 提取的是哪个单元格的值？
A: 程序会搜索指定列，找到包含关键词的单元格后，提取该单元格**右侧**（下一列）的值。

### Q: 拖拽功能无法使用怎么办？
A: 拖拽功能是可选的，如果无法使用不影响程序运行。请使用"添加文件"或"添加文件夹"按钮来添加文件，功能完全一样。

### Q: 如何快速添加大量文件？
A: 使用"添加文件夹"按钮，程序会自动扫描文件夹（包括子文件夹）中的所有Excel文件并添加到列表中。

## 注意事项

- 确保所有要合并的Excel文件使用相同的模板结构
- 单元格位置要准确，否则可能提取到错误的数据
- 建议先用少量文件测试配置是否正确
- 大量文件处理可能需要较长时间，请耐心等待

## 分发说明

### 作为Python程序分发
将整个项目文件夹打包，用户需要：
1. 安装Python 3.7+
2. 运行 `pip install openpyxl`
3. 运行 `python main.py` 或双击 `run.bat`

### 作为EXE程序分发
使用打包脚本生成exe后，只需要：
1. 将 `Excel账单合并工具.exe` 发送给用户
2. 用户双击运行即可，无需安装任何环境
3. 如有预设配置，可以同时提供 `config.json` 文件

## 更新日志

### v1.3.0 (2024-12-19)
- 🔄 重构主界面，改用按钮方式添加文件，更稳定可靠
- 📁 新增"添加文件夹"功能，自动扫描文件夹中所有Excel文件
- ➖ 新增"移除选中"功能，可以删除列表中不需要的文件
- 📊 新增文件计数显示
- 🎯 拖拽功能改为可选，不影响核心功能使用
- 💪 提升程序稳定性和兼容性

### v1.2.0 (2024-12-19)
- 🔧 结算金额搜索列和关键词现在可配置
- 📝 每个预设可以有不同的结算金额提取规则
- 🎨 优化配置界面，集中管理所有配置项

### v1.1.0 (2024-12-19)
- 🤖 新增自动提取功能：自动搜索D列"折后总计"并提取结算金额
- ✨ 汇总表自动添加"结算金额"列（最后一列）
- 🎯 无需手动配置映射，智能识别提取

### v1.0.0 (2024-12-19)
- ✨ 首次发布
- 🎉 支持拖拽导入Excel文件
- 🔧 灵活的预设和映射配置系统
- 👀 Excel文件预览功能
- 📊 自动生成汇总Excel表格

## 开发者

如需定制开发或有任何问题，请联系开发团队。

## 许可证

本项目仅供内部使用。

---

**享受高效的账单合并体验！** 🚀

